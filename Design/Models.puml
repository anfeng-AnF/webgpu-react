@startuml GenshinEditor

' 样式设置
skinparam class {
    BackgroundColor White
    ArrowColor #4A9EFF
    BorderColor #666666
    FontColor Black
}

skinparam package {
    BackgroundColor WhiteSmoke
    BorderColor #999999
}

skinparam note {
    BackgroundColor #FFFFCC
    BorderColor #999999
}

' 核心系统
package "Core" {
    class CApp {
        - GameEngine: GameEngine
        - PageModel: UPageModel
        - AnimationFrameId: number
        - LastFrameTime: number
        - TargetFPS: number
        + Initialize()
        + StartMainLoop()
        + MainLoop()
        + StopMainLoop()
        + Shutdown()
    }

    class GameEngine {
        - RenderEngine: RenderEngine
        - InputManager: InputManager
        - ResourceManager: ResourceManager
        - SceneManager: SceneManager
        + Init()
        + Tick(DeltaTime)
        + Shutdown()
    }
}

' UI系统
package "UI System" {
    class UPageModel {
        - {static} Instance: UPageModel
        - State: UIState
        - Delegates: Set
        - bIsInitialized: boolean
        + Init()
        + Tick(DeltaTime)
        + BindStateChanged(Delegate)
        + BroadcastStateChange()
        + SetPageState(NewState)
        + UpdatePanelConfig(NewConfig)
        + SetActiveTool(ToolType)
        + Shutdown()
    }

    class UPageContainer {
        - GameEngine: GameEngine
        + render()
    }

    class UBasePage {
        # bIsLoading: boolean
        # bIsError: boolean
        + OnMount()
        + OnUnmount()
    }
}

' UI组件
package "UI Widgets" {
    class UToolbar
    class UViewport
    class UWorldOutliner
    class UDetailsPanel
    class UContentBrowser
    class UActorPanel
}

' 引擎子系统
package "Engine Systems" {
    class RenderEngine
    class InputManager
    class ResourceManager
    class SceneManager
}

' 关系定义
CApp *-- GameEngine
CApp *-- UPageModel

GameEngine *-- RenderEngine
GameEngine *-- InputManager
GameEngine *-- ResourceManager
GameEngine *-- SceneManager

UPageModel <-- UPageContainer
UBasePage <|-- UHomePage
UBasePage <|-- ULoadingPage
UBasePage <|-- UErrorPage

UHomePage *-- UToolbar
UHomePage *-- UViewport
UHomePage *-- UWorldOutliner
UHomePage *-- UDetailsPanel
UHomePage *-- UContentBrowser
UHomePage *-- UActorPanel

note right of CApp
  应用程序入口点
  只负责初始化和协调
  核心系统的运行
end note

note right of UPageModel
  UI状态管理器
  处理所有UI相关的
  状态和事件
end note

note right of GameEngine
  游戏引擎核心
  管理所有游戏系统
  的初始化和更新
end note

@enduml
